# マルチプレイヤー機能 デプロイガイド

## デプロイ前の確認事項

### 1. コード品質チェック

全てのチェックが通過することを確認してください：

```bash
# 型チェック
npx tsc --noEmit

# リント
npm run lint

# テスト
npm test

# ビルド
npm run build
```

### 2. 統合チェックリスト

`.kiro/specs/multiplayer/integration-checklist.md`を確認して、全ての統合項目が完了していることを確認してください。

### 3. テスト計画の実行

`.kiro/specs/multiplayer/test-plan.md`に記載されているテストケースを実行してください。

## デプロイ手順

### 方法1: Makefileを使用（推奨）

```bash
# テストを実行してからデプロイ
make deploy
```

このコマンドは以下を自動的に実行します：
1. 全てのテストを実行
2. 変更をgitにコミット
3. リモートリポジトリにプッシュ
4. Devvitにアップロード

### 方法2: 手動デプロイ

```bash
# 1. テストを実行
npm test

# 2. ビルド
npm run build

# 3. Devvitにアップロード
npm run launch
```

## デプロイ後の確認

### 1. Devvitプレイテスト

デプロイが完了したら、Devvitのプレイテスト環境で動作確認を行います：

```bash
# プレイテストを開始
npm run dev
```

プレイテストURLが表示されるので、ブラウザで開いてください。

### 2. 基本動作確認

以下の項目を確認してください：

#### ゲーム作成
- [ ] タイトル画面が表示される
- [ ] 「Create Game」ボタンをクリックできる
- [ ] ゲーム設定画面が表示される
- [ ] プレイヤー数、時間、ラウンドを選択できる
- [ ] 「Start Game」でロビーに遷移する

#### ロビー
- [ ] プレイヤーリストが表示される
- [ ] ホストマークが表示される
- [ ] カウントダウンが動作する（満員時）
- [ ] 「Start Game」ボタンが機能する（ホストのみ）

#### ゲームプレイ
- [ ] ゲームが開始される
- [ ] プレイヤーが移動できる
- [ ] HUDが表示される（タイマー、燃料、ステータス）
- [ ] アビリティが使用できる（ジェットパック、ダッシュ、ジャンプ）

#### ゲーム終了
- [ ] タイマーが0になるとゲームが終了する
- [ ] 結果画面が表示される
- [ ] 統計が更新される

### 3. マルチプレイヤー確認

複数のブラウザウィンドウで以下を確認してください：

#### ゲーム参加
- [ ] 別のブラウザで「Join Game」をクリック
- [ ] ゲームリストに作成したゲームが表示される
- [ ] ゲームに参加できる
- [ ] ロビーのプレイヤーリストが更新される

#### 同期確認
- [ ] 一方のブラウザでプレイヤーを移動
- [ ] もう一方のブラウザで移動が反映される
- [ ] 移動がスムーズである（補間）
- [ ] アビリティの使用が同期される

#### エラーハンドリング
- [ ] 一方のブラウザを閉じる
- [ ] もう一方で切断が検出される
- [ ] AIプレイヤーに置き換えられる

### 4. パフォーマンス確認

以下のメトリクスを確認してください：

- **FPS**: 30以上を維持
- **レイテンシ**: 200ms以下
- **メモリ使用量**: 安定している（リークなし）
- **ネットワーク帯域**: 合理的な範囲内

ブラウザの開発者ツールを使用して確認できます：
- Chrome: F12 → Performance タブ
- Firefox: F12 → Performance タブ

## 複数アカウントでのテスト

より本格的なテストを行うには、複数のRedditアカウントを使用します：

### 準備

1. 複数のRedditアカウントを作成（または既存のアカウントを使用）
2. 各アカウントでDevvitにログイン
3. プレイテストURLを各アカウントで開く

### テスト手順

1. **アカウント1**: ゲームを作成
2. **アカウント2-N**: ゲームに参加
3. 全員でゲームをプレイ
4. 同期、タグ、アビリティなどを確認

## トラブルシューティング

### デプロイが失敗する

**症状**: `npm run launch`が失敗する

**解決策**:
1. Devvit CLIがインストールされているか確認: `devvit --version`
2. ログインしているか確認: `devvit whoami`
3. 再ログイン: `devvit login`
4. プロジェクト名が変更されていないか確認（devvit.json）

### ゲームが表示されない

**症状**: プレイテストURLを開いてもゲームが表示されない

**解決策**:
1. ビルドが成功しているか確認: `npm run build`
2. ブラウザのキャッシュをクリア
3. ブラウザのコンソールでエラーを確認
4. サーバーログを確認

### 同期が動作しない

**症状**: リモートプレイヤーの移動が反映されない

**解決策**:
1. ネットワークタブでAPI呼び出しを確認
2. `/api/game/:id/update`が成功しているか確認
3. `/api/game/:id`が正しいデータを返しているか確認
4. ブラウザのコンソールでエラーを確認

### パフォーマンスが悪い

**症状**: FPSが低い、カクつく

**解決策**:
1. ブラウザの開発者ツールでパフォーマンスプロファイルを取得
2. ボトルネックを特定（レンダリング、ネットワーク、計算）
3. 必要に応じて最適化を実施
4. プレイヤー数を減らして確認

## デプロイ完了チェックリスト

全ての項目にチェックが入ったら、デプロイ完了です：

- [ ] コード品質チェックが全て通過
- [ ] 統合チェックリストが完了
- [ ] テスト計画が実行され、全て合格
- [ ] Devvitにデプロイ成功
- [ ] プレイテスト環境で基本動作確認完了
- [ ] マルチプレイヤー機能確認完了
- [ ] パフォーマンス確認完了
- [ ] 複数アカウントでのテスト完了（オプション）
- [ ] READMEが更新されている
- [ ] ドキュメントが最新

## 次のステップ

デプロイが完了したら：

1. **コミュニティに共有**: r/Devvitでゲームを共有
2. **フィードバック収集**: プレイヤーからのフィードバックを収集
3. **バグ修正**: 発見されたバグを修正
4. **機能追加**: 新しい機能を追加
5. **パフォーマンス最適化**: さらなる最適化を実施

## サポート

問題が発生した場合：

1. **ドキュメント**: [Devvit Documentation](https://developers.reddit.com/docs)
2. **コミュニティ**: [r/Devvit](https://www.reddit.com/r/Devvit)
3. **Discord**: [Devvit Discord](https://discord.com/invite/R7yu2wh9Qz)
4. **GitHub Issues**: プロジェクトのGitHubリポジトリでissueを作成

## まとめ

マルチプレイヤー機能のデプロイは以下の手順で完了します：

1. ✅ コード品質チェック
2. ✅ テスト実行
3. ✅ Devvitにデプロイ
4. ✅ プレイテスト環境で確認
5. ✅ マルチプレイヤー機能確認
6. ✅ パフォーマンス確認
7. ✅ ドキュメント更新

全ての手順が完了したら、マルチプレイヤー機能は本番環境で利用可能になります！
